# 1. GPIO

GPIO是指`通用输入输出（General Purpose Input/Output），是一种通用的数字输入输出接口，可以通过程序控制来读取或控制外部设备`。
在单片机或嵌入式系统中，GPIO通常由一个或多个引脚组成，可以通过编程来配置引脚的**工作模式**（输入或输出）、**电平状态**（高电平或低电平）等参数，数字芯片的IO口，一般分为输入和输出。数字芯片内部单元大都是CMOS，一般mos的栅极为输入，漏极为输出。
# 2. 输出类型

## 2.1 推挽输出

推挽输出是指`输出端口通过一个晶体管的开关来控制电平状态，推挽输出可以实现高电平和低电平两种状态。`
TTL`（Transistor-Transistor Logic）`推挽结构和CMOS`（Complementary Metal-Oxide-Semiconductor）`推挽结构是两种常见的数字电路输出结构，它们在工作原理、性能和应用上有显著的区别和特点。
![[Pasted image 20240623155440.png|320x200]] ![[Pasted image 20240623155523.png|320x200]]
TTL推挽结构由NPN型双极性晶体管（BJT）组成。典型的电路中包含一个上拉晶体管和一个下拉晶体管。TTL电路是**电流驱动**的，输入端需要提供一定的电流才能使晶体管导通。由于BJT在导通状态下需要持续的基极电流，**功耗相对较高**。TTL电路的**开关速度**比起COMS来说较**慢**，**工作电压范围**较窄，标准TTL电路工作在5V电源下，输出高电平>2.4V,输出低电平<0.4V。在室温下，一般输出高电平是3.5V，输出低电平是0.2V。最小输入高电平和低电平：输入高电平>=2.0V，输入低电平<=0.8V，噪声容限是0.4V。
CMOS推挽结构由一个P型和一个N型MOSFET组成。P型MOSFET连接到电源电压，N型MOSFET连接到地。CMOS电路是电压驱动的，静态时几乎**不消耗电流**，功耗主要在开关瞬间，且有**非常高的开关速度**。CMOS电路的1逻辑电平电压接近于电源电压，0逻辑电平接近于0V，而且具有很宽的噪声容限。
由于COMS管的出色性能，所以目前电路大多数都使用CMOS推挽结构。
![推挽输出高电平|300x200](https://developer.qcloudimg.com/http-save/yehe-9445747/db53e6afe85940c6a1117a6c02fbbe14.png) ![[Pasted image 20240623155022.png|300x200]]

输出高电平时，NPN型晶体管导通，PNP型晶体管截止，呈现向外推的形式，为`推`；输出低电平时，PNP型晶体管导通，NPN型晶体管截止，呈现向回挽的形式，为`挽`。

- 优点：
1. 输出高低电平、电源电压基本没有压差
2. 高低电平驱动能力较强，由于使用mos管或者一般数字芯片推挽，输出IO口驱动电流最大可到**20mA**，
3. 电平切换速度快

- 缺点： 不支持`线与(指俩个输出不可以接到一起)`,

>[!NOTE] 
>当两个输出为相反电平的时候，电源会直接接地，由于MOS管的等效电阻很小，所以相与之后，电流会烧坏器件。并不会输出电压为低电平，也就是无法完成`与`操作
![[Pasted image 20240623161208.png]]
## 2.2 开漏输出

输出端口通过一个晶体管的开关来控制电平状态，但与推挽输出不同，**开漏输出只能实现低电平状态，而不能直接输出高电平**。
开漏输出的原理是，在输出端口接入一个NPN型晶体管，它的集电极连接到输出端口，发射极接地。**当需要输出低电平时，晶体管导通，输出端口接地，形成低电平；当需要输出高电平时，晶体管截止，输出端口处于悬空状态，即高阻态**。
为了实现完整的输出功能，开漏输出通常**需要结合外部上拉电阻**。当输出端口处于高阻态时，外部上拉电阻将输出端口拉高至所需的高电平。因此，开漏输出可以通过控制晶体管的导通和截止来实现低电平输出，而高电平输出则由外部上拉电阻提供。开漏输出常用于**多路设备共享总线**的情况下，如I2C、SPI等通信协议中。通过多个开漏输出端口的组合，可以实现多路设备对总线的控制，同时**避免输出冲突和电平干扰**。

![[Pasted image 20240623161837.png]]

- 优点：
1. 可**实现电平转换**，输出电平取决于上拉电阻电源
2. 可以实现IO的**线与**

- 缺点：
1. 高电平的**驱动能力差**，取决于外部上拉电阻，通常上拉电阻大小为1k或者4.7k
2. 电平**切换速率**取决于外部上拉电阻，电阻越小速度越快

## 2.3 高阻态

关于开漏输出的高阻态，他通常用在总线上，当主设备与其中一个从设备相连的时候，阻断其他设备与主设备相连，即呈现出高阻态的形式。

![在这里插入图片描述](https://developer.qcloudimg.com/http-save/yehe-9445747/bd399397719daf8985ce5e7c4402bb5e.png)

在这里插入图片描述

# 3. 输入

## 3.1 上拉输入

是指芯片输入引脚通过电阻接到电源电压

![在这里插入图片描述](https://developer.qcloudimg.com/http-save/yehe-9445747/85c7fa895098da18cd2e35572b2e627f.png)


## 3.2 下拉输入

指芯片输入引脚通过电阻借到参考0电平

![在这里插入图片描述](https://developer.qcloudimg.com/http-save/yehe-9445747/8ac75b21753b1f9e4d34ee8077716402.png)


## 3.3 浮空输入

浮空输入是指将输入引脚未连接到任何外部信号源或电路，使其处于未定义的状态。在这种情况下，输入引脚既不连接到高电平（VDD）也不连接到低电平（GND），而是处于开路状态。

浮空输入可能会导致**输入信号漂移或产生不确定**的结果。这是因为未连接的输入引脚可以受到周围环境中的电磁干扰，从而引起电压波动，进而影响输入状态。在某些情况下，浮空输入可能会被误认为是高电平或低电平，这取决于具体的电路设计和输入引脚的特性。

# 4. STM32 GPIO电路设计

![在这里插入图片描述](https://developer.qcloudimg.com/http-save/yehe-9445747/d8c7b45c70aafb8701932697823b4a21.png)

当N-MOS晶体管导通，P-MOS晶体管截止，呈现向外推的形式，为`推`，P-MOS管截止，N-MOS导通，为挽。 当为开漏状态时，只需要N-MOS管，当需要输出低电平时，晶体管导通，输出端口接地，形成低电平；当需要输出高电平时，晶体管截止，输出端口处于悬空状态，即高阻态。